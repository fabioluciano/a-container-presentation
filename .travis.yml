sudo: true
language: c
compiler: gcc

services:
  - docker

jobs:
  include:
    - stage: "Publish docs"
      script:
        - mkdir -p output
        - cp -r $TRAVIS_BUILD_DIR/src/resources/image output/
        - docker run --rm -v $TRAVIS_BUILD_DIR:/documents/ asciidoctor/docker-asciidoctor asciidoctor -o index.html -r asciidoctor-diagram  -D output -a plantuml-config=resources/plantuml/plantuml.cfg src/README.adoc
        - docker run --rm -v $TRAVIS_BUILD_DIR:/documents/ asciidoctor/docker-asciidoctor asciidoctor-pdf -o doc.pdf -r asciidoctor-diagram  -D output -a plantuml-config=resources/plantuml/plantuml.cfg src/README.adoc
        - docker run --rm -v $TRAVIS_BUILD_DIR:/documents/ asciidoctor/docker-asciidoctor asciidoctor-revealjs -a revealjsdir=https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.8.0 -o presentation.html -r asciidoctor-diagram  -D output -a plantuml-config=resources/plantuml/plantuml.cfg src/README.adoc
        - sudo rm -rf $TRAVIS_BUILD_DIR/output/.asciidoctor
        - tar -czvf output.tar.gz -C output .
        - docker build -t containerization-presentation:$TRAVIS_TAG --build-arg DEPLOYMENT=output.tar.gz .
        - echo "$DOCKER_HUB_PASSWORD" | docker login -u "$DOCKER_HUB_USERNAME" --password-stdin
        - docker push containerization-presentation:$TRAVIS_TAG
	      - rm output.tar.gz
      deploy:
        provider: pages
        target-branch: gh-pages
        skip_cleanup: true
        local_dir: output/
        github_token: $GH_TOKEN
        on:
          tags: true
